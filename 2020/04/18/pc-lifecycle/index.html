<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Zebra前端团队博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.0.0">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://blog.zebrateam.cn">
    <!--SEO-->

<meta name="keywords" content="Zebra,3.0,pc,lifecycle" />


<meta name="description" content="

本文是第六期分享主题 -「PC客户端各生命周期详解」的文字稿，可以通过查看来巩固知识点。

一、前言本文是根据2020.04.18 日，第六期分享主题「PC客户端各生命周期详解」整理而来的文..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    第六期 - 「PC客户端各生命周期详解」 - (2020.4.18) |
    
    Zebra前端团队博客
</title>

<link rel="alternate" href="/atom.xml" title="Zebra前端团队博客" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">

    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<meta name="generator" content="Hexo 4.2.1"></head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    /./img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='SCM'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <h2>
                分享是件简单有趣的事情
            </h2>
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://blog.zebrateam.cn">
                        Zebra前端团队博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/分享专栏/"><i class="fa "></i>
                                分享专栏</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/解决方案/"><i class="fa "></i>
                                解决方案</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/工程化/"><i class="fa "></i>
                                工程化</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/辅助工具/"><i class="fa "></i>
                                辅助工具</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="第六期 - 「PC客户端各生命周期详解」 - (2020.4.18)">
            
            第六期 - 「PC客户端各生命周期详解」 - (2020.4.18)
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/%E5%88%86%E4%BA%AB%E4%B8%93%E6%A0%8F/">分享专栏</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-link" href="/tags/3-0/" rel="tag">3.0</a> <a class="tag-link" href="/tags/Zebra/" rel="tag">Zebra</a> <a class="tag-link" href="/tags/lifecycle/" rel="tag">lifecycle</a> <a class="tag-link" href="/tags/pc/" rel="tag">pc</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2020/04/18</span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p><img src="/images/zebra/6/banner.png" alt=""></p>
<blockquote>
<p>本文是第六期分享主题 -「PC客户端各生命周期详解」的文字稿，可以通过查看来巩固知识点。</p>
</blockquote>
<h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p><strong>本文是根据2020.04.18 日，第六期分享主题「</strong>PC客户端各生命周期详解<strong>」整理而来的文字稿。</strong></p>
<p>本文分享以 “过程” 为切入点，对PC桌面应用程序开发主要生命周期关注点展开话题，以思路引导为主，带你全面理解开发应用程序各关注点。</p>
<h1 id="二、介绍"><a href="#二、介绍" class="headerlink" title="二、介绍"></a>二、介绍</h1><h2 id="2-1-我是谁？"><a href="#2-1-我是谁？" class="headerlink" title="2.1. 我是谁？"></a>2.1. 我是谁？</h2><p>SCM，2009年参加工作，直到2014年中旬前主要从事后端JAVA开发，期间善于使用ExtJs，那会还没有明确的前后端之分，处于全栈开发时期。一个偶然的契机，接手了公司的前端框架，出于些特殊原因，要重新写一套适合公司的框架，EraJs应运而生，这目前还是公司占80%以上项目PC WEB项目的首选框架。这一从事前端框架开发，2014 ~ 至今，6年过去了，期间整过Jquery、Bootstrap、Zepto、Jquery UI、第三方UI插件等等源码，也产出了Eui1.0、T2.0、T3.0、T3.5(T系列框架主要使用于PC客户端)。构建从Grunt到后来的Gulp，再到现在的Webpack，现在主攻React方向中后端最佳解决方案，可视化开发、工程化建设、基建完善。</p>
<h2 id="2-2-我们的团队"><a href="#2-2-我们的团队" class="headerlink" title="2.2. 我们的团队"></a>2.2. 我们的团队</h2><p>我所带领的前端框架组，目前主要3个人，主要服务于公司PC WEB、PC客户端项目框架支撑工作，逐渐完善框架体系，更好的提效，做好技术支撑工作。</p>
<h2 id="2-3-怎么联系我？"><a href="#2-3-怎么联系我？" class="headerlink" title="2.3. 怎么联系我？"></a>2.3. 怎么联系我？</h2><p>下面是我的微信二维码，对前端基建充满兴趣的可以加我交流，我们也会定期的分享更多框架相关的主题。<br /><img src="/images/wechat.jpeg#align=left&display=inline&height=296&name=WechatIMG1.jpeg&originHeight=896&originWidth=674&size=61371&status=done&style=none&width=223" alt="WechatIMG1.jpeg"><br /></p>
<h1 id="三、主题背景"><a href="#三、主题背景" class="headerlink" title="三、主题背景"></a>三、主题背景</h1><p><br />在开发中，可能会存在以下疑问：<br /></p>
<ul>
<li>对客户端开发各阶段没有一个直观的了解</li>
<li>只知道如何开发业务功能，对工程体系一无所知</li>
<li>效率不高，出问题坐等支持，自己不知所措</li>
<li>…</li>
</ul>
<p><br /> 针对以上困惑，接下来从工程体系各阶段做全面的解读，带你全面了解工程化各生命周期。 </p>
<h1 id="四、初始化工程"><a href="#四、初始化工程" class="headerlink" title="四、初始化工程"></a>四、初始化工程</h1><p><br />在介绍工程脚手架之前，我们先来了解下yeoman。</p>
<h2 id="4-1-什么是Yeoman"><a href="#4-1-什么是Yeoman" class="headerlink" title="4.1 什么是Yeoman?"></a>4.1 什么是Yeoman?</h2><p><br />Yeoman帮助我们创建项目，提供更好的工具来使我们的项目更多样化，Yeoman其实是三个工具的集合：yo、grunt、bower。这里我们主要使用的yo(脚手架)工具。<br />Yeoman提供generator系统，一个generator是一个插件，在我们在一个完整的项目上使用<code>yo</code>命令时，会运行该generator。<br /></p>
<h2 id="4-2-安装yo以及脚手架"><a href="#4-2-安装yo以及脚手架" class="headerlink" title="4.2 安装yo以及脚手架"></a>4.2 安装yo以及脚手架</h2><p>命令行执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install yo -g</span><br></pre></td></tr></table></figure>

<p>针对titanOne3.0框架，我们开发了自定义的generator，可以更便捷的创建项目并开发，脚手架名为: _generator-titanone_。</p>
<p>命令行执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install generator-titanone -g</span><br></pre></td></tr></table></figure>

<h2 id="4-3-创建工程"><a href="#4-3-创建工程" class="headerlink" title="4.3 创建工程"></a>4.3 创建工程</h2><p><br />_generator-titanone_脚手架安装完成之后，在任意目录创建文件夹并进入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir titanOne-demo &amp;&amp; <span class="built_in">cd</span> titanOne-demo</span><br></pre></td></tr></table></figure>

<p><br />执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo titanone</span><br></pre></td></tr></table></figure>

<p>根据提示依次操作：</p>
<ol>
<li>输入<code>工程目录名</code>（默认为titanOne-quickstart)</li>
<li>选择运行环境（electron/web，使用光标上下键切换）</li>
<li>输入<code>项目应用名</code>（默认为quickstart）</li>
</ol>
<p><br />完成输入/选择之后，依次按回车键确认，待命令执行完毕，项目创建成功。<br /></p>
<h2 id="4-4-创建业务模块"><a href="#4-4-创建业务模块" class="headerlink" title="4.4 创建业务模块"></a>4.4 创建业务模块</h2><p><br />首次创建业务模块时，需要在应用根目录（例如：<code>titanOne-demo-pc</code>）的目录下打开命令行并执行脚手架命令，之后则对命令行的打开目录则无强制要求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo titanone:module</span><br></pre></td></tr></table></figure>
<p>依次提示：</p>
<ol>
<li>选择当前语言环境</li>
<li>输入作者姓名</li>
<li>输入模块路径</li>
<li>输入模块名称（默认为index）</li>
</ol>
<p><br />完成输入/选择之后按回车键确认，命令执行完毕，在<code>titanOne-demo-pc/app/views</code>目录下创建业务模块路径成功。查看模块下文件，包含标准的entry_index.page、entry_index.js、以及国际化目录i18n等相关文件。<br /></p>
<h2 id="4-5-创建多应用"><a href="#4-5-创建多应用" class="headerlink" title="4.5 创建多应用"></a>4.5 创建多应用</h2><p><br />脚手架支持在工程目录下创建多个应用目录，需要在工程根目录下打开命令行并执行脚手架命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo titanone:ex</span><br></pre></td></tr></table></figure>

<p>执行命令之后，依次提示：<br /></p>
<ol>
<li>输入应用名称</li>
<li>选择运行环境（electron/web）</li>
</ol>
<p><br />完成输入/选择之后按回车键确认，命令执行完毕，应用目录创建成功。<br /></p>
<h1 id="五、工程规范"><a href="#五、工程规范" class="headerlink" title="五、工程规范"></a>五、工程规范</h1><h2 id="5-1-标准工程目录及配置"><a href="#5-1-标准工程目录及配置" class="headerlink" title="5.1 标准工程目录及配置"></a>5.1 标准工程目录及配置</h2><p><br />基于脚手架创建的标准工程目录结构是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">titanOne-demo</span><br><span class="line">├── bin</span><br><span class="line">├── ├── electron.bat</span><br><span class="line">├── ├── electron.sh</span><br><span class="line">├── config</span><br><span class="line">├── ├── electron</span><br><span class="line">├── ├── ├── init.json</span><br><span class="line">├── ├── ├── version.json</span><br><span class="line">├── README.md</span><br><span class="line">├── titanOne-demo-pc</span><br><span class="line">├── ├── app</span><br><span class="line">├── ├── ├── public</span><br><span class="line">├── ├── ├── ├──  js</span><br><span class="line">├── ├── ├── ├──  ├── common.js</span><br><span class="line">├── ├── main.js</span><br><span class="line">├── ├── mapping.json</span><br><span class="line">├── ├── node_modules</span><br><span class="line">├── ├── npm-scripts</span><br><span class="line">├── ├── ├── before-build.script.js</span><br><span class="line">├── ├── ├── generate.entry.file.js</span><br><span class="line">├── ├── package.json</span><br><span class="line">├── ├── README.md</span><br><span class="line">├── ├── tests</span><br><span class="line">├── ├── ├── data</span><br><span class="line">├── ├── ├── ├── desktop.json</span><br><span class="line">├── ├── ├── ├── menu.json</span><br><span class="line">├── ├── ├── init.json</span><br><span class="line">├── ├── ├── mapping.json</span><br><span class="line">├── ├── webpack.config.js</span><br><span class="line">├── tool</span><br><span class="line">├── ├── app</span><br><span class="line">├── ├── ├── electron</span><br><span class="line">├── ├── ├── ├── app</span><br><span class="line">├── ├── ├── ├── ├── main.js</span><br><span class="line">├── ├── ├── ├── ├── package.json</span><br><span class="line">├── ├── ├── ├── Gruntfile.js</span><br><span class="line">├── ├── ├── ├── package.json</span><br><span class="line">├── ├── ├── utils</span><br><span class="line">├── ├── ├── ├── index.js</span><br><span class="line">├── ├── electron</span><br><span class="line">├── ├── ├── package.json</span><br><span class="line">├── ├── theme</span><br><span class="line">├── ├── ├── asserts</span><br><span class="line">├── ├── ├── electron</span><br><span class="line">├── ├── ├── ├── Gruntfile.js</span><br><span class="line">├── ├── ├── ├── package.json</span><br><span class="line">├── ├── utils</span><br><span class="line">├── ├── ├── config.js</span><br></pre></td></tr></table></figure>

<h3 id="5-1-1-主要目录介绍"><a href="#5-1-1-主要目录介绍" class="headerlink" title="5.1.1 主要目录介绍"></a>5.1.1 主要目录介绍</h3><ul>
<li>bin:  快速编译构建脚本目录</li>
<li>config: 发布版本配置文件目录</li>
<li>dist: 编译输出asar临时目录</li>
<li>setup: 打包脚本.iss及输出Output目录</li>
<li>tool: 打包编译框架app.asar,theme.asar包工程等</li>
<li>tool/app/asserts: 公共共享资源目录，比如：多个项目公共引用的图表包eKLine等，开发阶段会引用到上下文</li>
<li>tool/theme/asserts: 覆盖框架样式资源文件目录，比如：登录，主页logo图片替换或自定义customCss资源等</li>
<li>config.json: 打包阶段编译构建选项配置，比如：theme,i18n等</li>
<li>.titanOne: 项目下的webpack约定配置，主要为了webpack构建灵活性</li>
</ul>
<h3 id="5-1-2-webpack-config-js"><a href="#5-1-2-webpack-config-js" class="headerlink" title="5.1.2 webpack.config.js"></a>5.1.2 <strong>webpack.config.js</strong></h3><p>**<br />框架已经将webpack相关构建封装到<code>@erayt/titanOne-webpack-dependency</code>包中，一个标准的简单工程只需要定义引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; require(&#39;@erayt&#x2F;titanOne-webpack-dependency&#39;);</span><br></pre></td></tr></table></figure>

<p><br /><em><strong>默认webpack封装包做了什么？</strong></em><br /><br><br />底层包默认封装了对entry_<em>.js,entry_</em>.page解析编译及devServer相关配置，打包发布优化编译等。<br /><br><br /><em><strong>默认resolve定义alias:</strong></em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> alias: &#123;</span><br><span class="line">    commonjs: path.resolve(publicDir,<span class="string">'js/common.js'</span>),</span><br><span class="line">    artHelpers: path.resolve(publicDir,<span class="string">'js/artHelpers.js'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />默认对约定public目录下的common.js、artHelper.js做了别名约定，即：<br /><br><br />项目js中可以像下面这样引用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'commonjs'</span>);</span><br></pre></td></tr></table></figure>

<p><br /><em><strong>默认devtool:</strong></em><br />项目优化原则，打包阶段关闭sourceMap，开发阶段开启：<br /></p>
<ul>
<li>开发阶段：”source-map”</li>
<li>打包阶段：false</li>
</ul>
<p><br /><em><strong>如何重写框架约定的webpack构建?</strong></em><br /><br><br />框架公共封装包对外暴露webpack配置，所以，我们可以在webpack.config.js重写默认配置，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> libsDir = <span class="string">'./app/asserts/libs'</span>;</span><br><span class="line"><span class="keyword">let</span> webpackConfigs = <span class="built_in">require</span>(<span class="string">'@erayt/titanOne-webpack-dependency'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge.smart(webpackConfigs,&#123;</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            echarts: path.resolve(libsDir,<span class="string">'echarts/echarts.min.js'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: [</span><br><span class="line">            path.join(__dirname,<span class="string">"../tool/theme/asserts"</span>)</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>备注：定义自定义的配置，通过调用merge.smart深度合并到默认配置即可。</p>
</blockquote>
<p><br />如果个别项目开发过程，编译慢，卡顿比较明显，可在此配置:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devtool: <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="5-1-3-titanOne"><a href="#5-1-3-titanOne" class="headerlink" title="5.1.3 .titanOne"></a>5.1.3 .titanOne</h3><p><br />该配置作为项目中webpack灵活集成的约定配置文件，主要用来定义服务代理，打包优化，主题引用等。<br /></p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>类型</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>appName</td>
<td>String</td>
<td>应用名称，请保持与打包后的.asar名称及菜单配置中的applCode保持一致</td>
<td>‘app’</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>webpack服务端口</td>
<td>80</td>
</tr>
<tr>
<td>servers</td>
<td>Object</td>
<td>代理服务配置,格式key(服务上下文):value(服务地址)，开发阶段webpack生成代理来源</td>
<td>{}</td>
</tr>
<tr>
<td>theme</td>
<td>String</td>
<td>当前应用主题，可选：’default’ or ‘blue’</td>
<td>‘default’</td>
</tr>
<tr>
<td>changeOrigin</td>
<td>Boolean</td>
<td>是否改变远程域，具体了解webpack的devServer下的proxy的配置说明</td>
<td>false</td>
</tr>
<tr>
<td>commons</td>
<td>Boolean</td>
<td>是否提取app/public/js目录下公共js引用生成commons.min.js，minSize默认30000</td>
<td>true</td>
</tr>
<tr>
<td>devtool</td>
<td>Boolean</td>
<td>生产阶段是否开启sourMap，具体可参考<a href="">webpack</a>介绍</td>
<td>false</td>
</tr>
<tr>
<td>PEO</td>
<td>Boolean</td>
<td>是否为标准构建工程，为true时，开发阶段会引用tool/app/asserts、tool/theme/asserts目录下的资源赋值给devServer的contentBase</td>
<td>false</td>
</tr>
<tr>
<td>inline</td>
<td>Boolean</td>
<td>打包阶段是否内联模式，为true时，js,css都会写入html</td>
<td>false</td>
</tr>
<tr>
<td>pdfviewer</td>
<td>Boolean</td>
<td>是否集成pdf预览插件,为true会引用@erayt/titanOne-web-pdfviewer下的dist到contentBase</td>
<td>false</td>
</tr>
<tr>
<td>equery</td>
<td>Boolean</td>
<td>是否集成equery插件，为true会引用@erayt/titanOne-equery包下的build指定语言到contentBase</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id="5-1-4-config-json"><a href="#5-1-4-config-json" class="headerlink" title="5.1.4 config.json"></a>5.1.4 config.json</h3><p><br />该配置文件主要约定打包阶段编译配置。<br /></p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>类型</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>theme</td>
<td>String</td>
<td>引用主题，可选：”blue”或”default”(打包theme.asar引用)</td>
<td>“default”</td>
</tr>
<tr>
<td>i18n</td>
<td>String/Array</td>
<td>引用国际化版本，可选：”zh_CN”,”en”，需支持多语言时配置成数组格式</td>
<td>“zh_CN”</td>
</tr>
<tr>
<td>pdfviewer</td>
<td>Boolean</td>
<td>是否集成pdf预览插件，为true时会打包到app.asar</td>
<td>false</td>
</tr>
</tbody></table>
<h2 id="5-2-项目规范"><a href="#5-2-项目规范" class="headerlink" title="5.2 项目规范"></a>5.2 项目规范</h2><p><br />框架结合webpack开发构建，为了项目组开发人员更好的将重心放在业务上，webpack构建的脚本做了统一约定解析。<br /></p>
<h3 id="5-2-1-工程目录结构"><a href="#5-2-1-工程目录结构" class="headerlink" title="5.2.1 工程目录结构"></a>5.2.1 工程目录结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- ~root&#x2F;app&#x2F;</span><br><span class="line">   - public&#x2F;                      &#x2F;&#x2F;公共资源路径，其中包括：css、js、tpl；</span><br><span class="line">       		- &#x2F;css&#x2F;common.css           &#x2F;&#x2F;项目公共样式文件（项目中各个模块需要的公共样式文件，可放在该文件中）；</span><br><span class="line">          - &#x2F;js&#x2F;common.js             &#x2F;&#x2F; 项目公共js入口文件（项目中各个模块需要引用的公共代码）；</span><br><span class="line">          - &#x2F;tpl&#x2F;*.hbs                &#x2F;&#x2F;项目公共模板（无需修改）；</span><br><span class="line">   - views&#x2F;                      &#x2F;&#x2F;业务代码路径；</span><br><span class="line">          ...             </span><br><span class="line">   - npm-scripts                 &#x2F;&#x2F; 构建支持脚本</span><br><span class="line">   - tests                       &#x2F;&#x2F; 配置信息及测试数据</span><br><span class="line">        - data                  &#x2F;&#x2F; 桌面及菜单测试数据，开发阶段更方便维护菜单</span><br><span class="line">      	- init.json             &#x2F;&#x2F; 服务及代理信息配置</span><br><span class="line">        - mapping.json          &#x2F;&#x2F; 开发阶段，initjs及其他支持配置</span><br><span class="line">       ...                           &#x2F;&#x2F; .babelrc,.gitignore,.npmignore等</span><br><span class="line">   webpack.config.js             &#x2F;&#x2F; webpack相关定义</span><br><span class="line">   .titanone                     &#x2F;&#x2F; 应用名，端口，服务，主题及其他定义</span><br></pre></td></tr></table></figure>

<p><br />业务代码必须在<code>~root/app/views/</code>目录下，原则上每个业务模块为一个独立的目录，目录下包含入口页面文件(*.page)以及静态资源目录<code>~root/app/views/模块名称/static/</code>，<br>资源文件目录中包含js、css、json、i18n、validation等。<br /></p>
<h3 id="5-2-2-模块目录结构"><a href="#5-2-2-模块目录结构" class="headerlink" title="5.2.2 模块目录结构"></a>5.2.2 模块目录结构</h3><p><br />目录结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- <span class="built_in">module</span></span><br><span class="line">    - <span class="keyword">static</span></span><br><span class="line">        - i18n</span><br><span class="line">        - css</span><br><span class="line">        - js</span><br><span class="line">        - modals</span><br><span class="line">        - validation</span><br><span class="line">    entry_*.page</span><br></pre></td></tr></table></figure>


<blockquote>
<p>注意：每个.page页面对应个同名的js文件，框架会自动引入script。</p>
</blockquote>
<h3 id="5-2-3-关键文件规范"><a href="#5-2-3-关键文件规范" class="headerlink" title="5.2.3 关键文件规范"></a>5.2.3 关键文件规范</h3><ol>
<li><strong>入口页面entry_*.page</strong></li>
</ol>
<p>每个业务功能，都会有一个页面文件，这个文件的命名规则为<code>&quot;entry_*.page&quot;</code>，必须以<code>entry_</code>作为前缀，<code>.page</code>作为文件类型。（调试时，webpack会解析文件，将其生成对应的html文件）。<br /></p>
<ul>
<li><em>.page</em> 支持HTML标准语法及Handlebars语法</li>
<li>页面支持国际化，需要国际化的文字以<code>{ {i18n.*.*}}</code>替代即可, <code>*.*</code>对应国际化文件中的key值或者对象路径</li>
<li>页面中需要引用该功能模块内相对资源文件（<em>.json或者.hbs）,引用定义格式：`/static/**/</em>.json`</li>
<li>页面中DOM的id命名时，建议以<code>project_module_*</code>的方式命名(<code>项目简称_模块名_id</code>)，避免不同项目和不同模块间的命名重复(单页面div模式需注意)</li>
</ul>
<ol start="2">
<li><strong>入口js文件 entry_*.js</strong></li>
</ol>
<p>每个入口页面会对应一个入口js，名称与页面名称一致，格式：<code>entry_*.js</code>，调试时，webpack会解析该文件，将其生成对应的js文件，并将引用脚本写入对应的html页面文件中，其写法规范如下：<br /></p>
<p>引用公共js代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'commonjs'</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>备注：其中commonjs为webpack配置中定义的别名，详情可查看webpack的resolve的alias定义。</p>
</blockquote>
<p>引用css(.less or .css)样式文件，一般放在<code>static/css</code>目录下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require(&#39;..&#x2F;css&#x2F;*.less&#39;)</span><br></pre></td></tr></table></figure>

<p><br />功能需要对外暴露的方法或者属性，需要以<strong><em>export var objectName={}</em></strong>对象封装，以全局变量在外部（页面中）调用。<br>objectName即为全局变量，命名时需要避免模块间的重复，命名规范：_<strong>模块路径(驼峰命名规则) + Modal(固定后缀)</strong>_，例如：test模块下entry_index.js内objectName为<code>testMoal</code>，test模块下entry_test.js内objectName为<code>testTestMoal</code>（非index文件需要加上文件名称）。<br /></p>
<ul>
<li><code>onRender</code>：function类型，在页面渲染准备就绪之后，会自动解析该方法，相当于老版本框架的_Eui.onReady_方法</li>
<li><code>onMessage</code>：Object类型，封装在该对象中的属性，页面加载之后，会在页面中注册各消息通道，供监听事件</li>
</ul>
<p><br />实例：比如<code>views</code>目录有个_test_模块(test/entry_index.page)，那么<code>test/static/js</code>目录下必有_entry_index.js_文件，内容如下：<br /></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export var testMoal &#x3D; &#123;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    onRender: function()&#123;</span><br><span class="line">        &#x2F;&#x2F; 如果调用了Eui.onReady方法，必须定义在该事件内部</span><br><span class="line">    &#125;,</span><br><span class="line">    onMesssage: &#123;       &#x2F;&#x2F; 非必须定义，如果有自定义接收消息通道数据，则需定义，方便框架解析</span><br><span class="line">        &#39;自定义通道名称&#39;: function(e,args)&#123;</span><br><span class="line">            &#x2F;&#x2F; args 包含title,time,data三个属性</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>友情提示</strong>： 非必须对页面暴露的方法及属性不建议定义在_testModal_中，框架提供的默认通道可查看特殊消息通道详解。</p>
</blockquote>
<h3 id="5-2-4-自定义样式存放目录"><a href="#5-2-4-自定义样式存放目录" class="headerlink" title="5.2.4 自定义样式存放目录"></a>5.2.4 自定义样式存放目录</h3><p><br />在项目中需要引用外部的资源文件或需要根据项目自定义样式。可将资源文件放在根目录下的tool目录下的asserts:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~root&#x2F;tool&#x2F;                            </span><br><span class="line">    - theme&#x2F;                           &#x2F;&#x2F; 重写样式目录</span><br><span class="line">        - asserts&#x2F;</span><br><span class="line">            - index&#x2F;                   &#x2F;&#x2F; 主页重写样式</span><br><span class="line">                - &#x2F;static&#x2F;css&#x2F;</span><br><span class="line">                    - &#x2F;custom.css</span><br><span class="line">                    - &#x2F;img</span><br><span class="line">            - login&#x2F;                    &#x2F;&#x2F; 登录页替换图片</span><br><span class="line">                - &#x2F;static&#x2F;css&#x2F;img</span><br><span class="line">    - app&#x2F;                             &#x2F;&#x2F; 资源文件存放目录 </span><br><span class="line">        - asserts&#x2F;                   </span><br><span class="line">            - iframe&#x2F;                  &#x2F;&#x2F; iframe模块 </span><br><span class="line">            - index&#x2F;                   &#x2F;&#x2F; index模块</span><br><span class="line">            - libs&#x2F;</span><br><span class="line">                - charts&#x2F;</span><br><span class="line">                    - &#x2F;eKLine.js       &#x2F;&#x2F; 例如引入图表js</span><br></pre></td></tr></table></figure>


<ul>
<li>引入第三方JS包：存放的目录结构与框架引入模块的结构保持一致，编译时会进行拷贝。页面的调用路径为<code>../libs/charts/eKLine.js</code></li>
<li>重写框架样式：在init.json中配置<code>customCss</code>自定义css文件名</li>
</ul>
<blockquote>
<p>备注：图片的对应路径<code>node_modules/@erayt/titanOne3.0-theme-index/dist//css/img</code>，图片名称对应会进行替换。</p>
</blockquote>
<p><br /><em><strong>友情提醒：如何开启引用自定义样式？</strong></em><br />_<br />可在init.json中配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"customCss"</span>: <span class="string">"custom.css"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />特别注意：自定义的样式一定是放在_<strong>index/static/css</strong>_目录下。<br /></p>
<blockquote>
<p>备注：登录模块支持替换图片，对应路径<code>node_modules/@erayt/titanOne3.0-theme-login/dist//css/img</code>，图片名称对应会进行替换。</p>
</blockquote>
<h2 id="5-3-配置文件"><a href="#5-3-配置文件" class="headerlink" title="5.3 配置文件"></a>5.3 配置文件</h2><p><br />子应用主要涉及到以下配置文件：<br /></p>
<ul>
<li>init.json</li>
<li>mapping.json</li>
<li>menu.json</li>
<li>desktop.json</li>
<li>.titanOne<blockquote>
<p>备注：这里不做详解解释，可访问文档查看。</p>
</blockquote>
</li>
</ul>
<h1 id="六、主应用启动过程"><a href="#六、主应用启动过程" class="headerlink" title="六、主应用启动过程"></a>六、主应用启动过程</h1><p><br /><img src="/images/zebra/6/01.png" alt="系统交互图.jpg"><br /></p>
<h1 id="七、开发阶段"><a href="#七、开发阶段" class="headerlink" title="七、开发阶段"></a>七、开发阶段</h1><p><br />开发阶段你可能会关注以下点：<br /></p>
<ul>
<li>配置文件维护(mapping.json、setting.json、init.json、.titanOne等)</li>
<li>API文档快速查找</li>
<li>集成框架功能</li>
<li>个性化存储/定制</li>
<li>Mock接口使用(推荐使用EasyMock)</li>
<li>合理记录日志</li>
<li>等等</li>
</ul>
<p><br />这里今天不做详细一一解说，相关可以直接查找向导文档熟悉，这里今天主要讲下合理记录日志。<br /><br><br />为了方便调试，提供打印输出日志，可以指定不同的日志级别，大于等于全局设置日志级别level将会控制台上输出。<br /><br><br />全局日志级别由init.json中配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"logLevel"</span>: <span class="string">"warn"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>提示：默认日志级别false，即不记录任何日志。</p>
</blockquote>
<p><br />输出日志的方法_<strong>Eui.Logger.log</strong>_或者 _<strong>Eui.log</strong>_，两个方法等价。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>level</td>
<td>String</td>
<td>日志级别，支持: silly、debug、info、warn、error</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td>日志内容，支持占位，比如：”The type ‘{0}’ is not support!”</td>
</tr>
<tr>
<td>format</td>
<td>Boolean</td>
<td>是否需要格式化日志内容，如果有{0}占位符情况设置true</td>
</tr>
</tbody></table>
<blockquote>
<p>备注：参数传递遵循第一个参数定义日志级别，最后一个参数如果是boolean类型即format，中间可以有多个占位符的参数，比如：{0} - {1} - {2}。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Eui.Logger.log(<span class="string">"warn"</span>,<span class="string">"It not support!"</span>);</span><br><span class="line">Eui.Logger.log(<span class="string">"info"</span>,<span class="string">"hello &#123;0&#125;,welcome."</span>,<span class="string">"SCM"</span>,<span class="literal">true</span>);</span><br><span class="line">Eui.Logger.log(<span class="string">"error"</span>,<span class="string">"The type '&#123;0&#125;' is not support!"</span>,<span class="string">"panel"</span>,<span class="literal">true</span>);</span><br><span class="line">Eui.log(<span class="string">"debug"</span>, <span class="string">"今天是第%s期 -「&#123;1&#125;」分享。"</span>, <span class="string">"六"</span>,<span class="string">"PC客户端各生命周期详解"</span>, <span class="literal">true</span>);</span><br><span class="line">Eui.log(<span class="string">"debug"</span>, <span class="string">"今天是第%s期 -「%s」分享。"</span>, <span class="string">"六"</span>,<span class="string">"PC客户端各生命周期详解"</span>);</span><br></pre></td></tr></table></figure>

<p><br />当然该日志记录方法也支持<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Console" target="_blank" rel="noopener"><em><strong>console</strong></em></a>_** **_记录日志用法(占位符方式)。<br /></p>
<h1 id="八、入库发布版本"><a href="#八、入库发布版本" class="headerlink" title="八、入库发布版本"></a>八、入库发布版本</h1><h2 id="8-1-维护配置"><a href="#8-1-维护配置" class="headerlink" title="8.1 维护配置"></a>8.1 维护配置</h2><p><br />发布版本涉及到应用相关配置，以及全局版本及服务相关配置文件的维护。<br /></p>
<h3 id="8-1-1-子应用mapping-json配置"><a href="#8-1-1-子应用mapping-json配置" class="headerlink" title="8.1.1 子应用mapping.json配置"></a>8.1.1 子应用mapping.json配置</h3><p><br />该文件用来定义预加载页面(始终隐藏状态)、自定义参数设置、嵌入预执行JS相关配置。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"initjs"</span>:<span class="string">"ws/static/js/initParam.min.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />注意项：</p>
<ul>
<li>打包发布阶段，维护应用根目录下的mapping.json，注意与开发阶段文件的区分</li>
<li>initjs指向的文件路径相对于views目录，打包阶段文件后缀为<code>.min.js</code>, 注意与开发阶段<code>.bundle.js</code>区分</li>
<li>如果没有需要定义配置，可不需要此文件(加载本地桌面/菜单数据除外，需定义<code>{}</code>)。</li>
</ul>
<h3 id="8-1-2-子应用setting-json配置"><a href="#8-1-2-子应用setting-json配置" class="headerlink" title="8.1.2 子应用setting.json配置"></a>8.1.2 子应用setting.json配置</h3><p><br />除系统默认全局参数外，每个子应用都可以定义自定义参数项，来达到业务更灵活的个性化需求。开发与生产阶段存储目录有所不同。<br /></p>
<ul>
<li>开发阶段: <code>~root/tests/setting.json</code>，放在tests目录下</li>
<li>打包阶段: <code>setting.json</code>的存放根目录下，最终打包进xxx.asar包</li>
</ul>
<p><br />框架会读取合并所有应用参数配置，最终暴露<code>Eui.Setting</code>对象供调用，该对象是CacheMemory类的实例化，存储缓存key均以_<strong>‘system:param’</strong>_作为key的前缀，可调用该类的所有方法，比如get,set,remove,batchSet方法。<br /><br><br />调用方法示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 缓存中存储的实际key为:'system:param:widgetZoom'</span></span><br><span class="line"><span class="keyword">var</span> widgetZoom = Eui.Setting.get(<span class="string">'widgetZoom'</span>);</span><br><span class="line">Eui.log(<span class="string">'debug'</span>, widgetZoom); <span class="comment">// 打印的值为：'true'</span></span><br></pre></td></tr></table></figure>

<h3 id="8-1-3-主应用version-json配置"><a href="#8-1-3-主应用version-json配置" class="headerlink" title="8.1.3 主应用version.json配置"></a>8.1.3 主应用version.json配置</h3><p><br />该配置文件用来定义程序最新发布版本的增量版本(appVersion)号及全量版本号(frameVersion)。<br /></p>
<blockquote>
<p>提示：入库发布阶段，该文件在主工程根目录下的_<strong>config/electron/version.json</strong>_目录下。</p>
</blockquote>
<p><br />比如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"frameVersion"</span>:<span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"appVersion"</span>: <span class="string">"1.1.0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>提醒：该配置文件根据入库实际情况维护，遵循版本增量递增原则，如果仅发布增量版本，全量版本号无需更新。</p>
</blockquote>
<h3 id="8-1-4-主应用init-json配置"><a href="#8-1-4-主应用init-json配置" class="headerlink" title="8.1.4 主应用init.json配置"></a>8.1.4 主应用init.json配置</h3><p><br />该配置文件用来定义服务的相关上下文代理信息，以及一些个性化配置等。<br /></p>
<blockquote>
<p>提示：入库发布阶段，该文件在主工程根目录下的_<strong>config/electron/init.json</strong>_目录下。</p>
</blockquote>
<p><br />比如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"proxy"</span>: &#123;</span><br><span class="line">    <span class="attr">"ecas"</span>: &#123;</span><br><span class="line">      <span class="attr">"server"</span>:<span class="string">"http://192.168.10.129:8080"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"equery"</span>:&#123;</span><br><span class="line">      <span class="attr">"server"</span>:<span class="string">"192.168.10.138:8080"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-1-5-FAQ"><a href="#8-1-5-FAQ" class="headerlink" title="8.1.5 FAQ"></a>8.1.5 FAQ</h3><p><br /><strong>Q: 出于敏感信息保护，不希望_app.asar.unpacked_目录下的init.json暴露太多配置？</strong><br /><br><br />A：我们可以修改_<strong>tool/app/electron</strong>_目录下package.json下的</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"compile:asar": "asar pack app ../../../dist/electron/app.asar --unpack &#123;init,version&#125;.json",</span><br></pre></td></tr></table></figure>

<p>变更为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"compile:asar": "asar pack app ../../../dist/electron/app.asar --unpack \"version.json\"",</span><br></pre></td></tr></table></figure>

<p>这样，<strong><em>init.json</em></strong>将不会被打包到_<strong>dist/electron/app.asar.unpacked</strong>_目录下。</p>
<blockquote>
<p>如果部分配置期望对外暴露，我们可以直接修改app.asar.unpack目录下的init.json，可能您不期望不受信任的配置有效，那么可以配置<a href="http://127.0.0.1:8080/eui3.0/#!/api/Eui.env-property-allowUnpackOptions" target="_blank" rel="noopener">allowUnpackOptions</a>(更多说明查看文档)来限制。</p>
</blockquote>
<h2 id="8-2-版本入库"><a href="#8-2-版本入库" class="headerlink" title="8.2 版本入库"></a>8.2 版本入库</h2><p><br />服务端的编译是通过选择不同的”编译环境类型”来解析对应的描述文件执行构建任务。现就对客户端入库的相关文件作详细的说明，构建类型：<br /></p>
<ul>
<li>Node.js打包 : 定义模块需要执行<code>yarn upgrade</code>更新包及<code>npm run build</code>命令编译</li>
<li>Setup : 执行setup目录下的.iss文件制作exe</li>
<li>Node.js : 入库框架模块，最终需要发布npm到152私服</li>
</ul>
<blockquote>
<p>备注：常规的PC客户端入库需要选择”Node.js打包”和”Setup”，特殊情况下，比如：需要入库自定义登录模块的，必须选择”Node.js”类型（建议与项目代码不同分支管理）。</p>
</blockquote>
<p><br /><strong>特别提醒：基于titanOne3.5开发的项目入库必须是yarn编译，入库之前必须先找版本管理员指定yarn编译服务器，切记，切记，切记！！！</strong>。<br /></p>
<h3 id="8-2-1-Node-js打包"><a href="#8-2-1-Node-js打包" class="headerlink" title="8.2.1 Node.js打包"></a>8.2.1 Node.js打包</h3><p><br />该类型是客户端入库必选编译环境类型，包含tmp_update_Node.js.lst和tmp_Node.js.lst两个文件，格式：<code>编译类型 + 仓库名:多个文件路径</code>(以<code>,</code>分割)。<br /><br><br />实例如下，tmp_update_Node.js.lst 内容模版：<br /></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn_erayt_release_cnpm_public:examples,tool\theme\electron,tool\app\electron,tool\app\electron\app,tool\electron</span><br></pre></td></tr></table></figure>

<p><br />备注：以上内容是以titanOne quickstart的electron版本作介绍。<br /><br><br /><code>yarn_erayt_release_cnpm_public</code>为固定文本(编译环境指定的npm源仓库别名)，”:”后的为工程的目录(需要执行yarn upgrade来更新依赖的工程)。<br /><br><br />tmp_build.lst 内容模版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">examples,tool\theme\electron,tool\app\electron</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注：该描述文件用来定义需要执行<code>npm run build</code>命令(build定义在package.json中的scripts中)的工程目录，多目录以<code>,</code>号区分。</p>
</blockquote>
<h3 id="8-2-2-Setup"><a href="#8-2-2-Setup" class="headerlink" title="8.2.2 Setup"></a>8.2.2 Setup</h3><p><br />如果需要制作exe安装包，那么需要选择该编译环境类型，约定回去执行<code>setup</code>目录下的所有.iss文件(如果该目录包含logo.ico，那么会替换exe的安装桌面快捷图标)。<br /></p>
<h3 id="8-2-3-Node-js"><a href="#8-2-3-Node-js" class="headerlink" title="8.2.3 Node.js"></a>8.2.3 Node.js</h3><p><br />如果入库的模块需要发布到公司<a href="http://192.168.10.152:7001" target="_blank" rel="noopener">npm私服</a>，那么需要选择该类型。包含描述文件：tmp_Node.js.lst 和 tmp_update_Node.js.lst，内容模版如下：<br /></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn_erayt_release_cnpm_public:</span><br></pre></td></tr></table></figure>

<p><br />备注：以上内容为固定文本，<code>:</code>后定义执行命令的目录，多个以<code>,</code>号区分。规则同tmp_update_Node.js.lst文件定义。<br /><br><br />文件功能说明：<br /></p>
<ul>
<li>tmp_Node.js.lst：执行npm publish命令的工程目录定义</li>
<li>tmp_update_Node.js.lst：执行<code>yarn upgrade</code>命令再执行<code>npm publish</code>命令的命令。</li>
</ul>
<h3 id="8-2-4-FAQ"><a href="#8-2-4-FAQ" class="headerlink" title="8.2.4 FAQ"></a>8.2.4 FAQ</h3><p><br /><em><strong>Q: 如何入库发布自定义模块到私服？</strong></em><br /></p>
<ul>
<li>申请入库分支，编译环境类型必须为”Node.js”</li>
<li>通知版本管理员(马XX)，指定编译服务器</li>
<li>初始化入库工程，模块以及描述文件tmp_Node.js.lst 和 tmp_update_Node.js.lst，具体注意项可参考上述。</li>
</ul>
<h1 id="九、预投产演练阶段"><a href="#九、预投产演练阶段" class="headerlink" title="九、预投产演练阶段"></a>九、预投产演练阶段</h1><p><br />投产演练阶段，还有个重要的环节，维护自动更新服务报文数据。<br /></p>
<h2 id="9-1-自动更新"><a href="#9-1-自动更新" class="headerlink" title="9.1 自动更新"></a>9.1 自动更新</h2><p><br />自动更新服务接口作为PC客户端检测判断一个重要数据来源，版本信息中主要包含：平台信息、版本信息、加密MD5值、资源下载地址、变更日志等信息。</p>
<blockquote>
<p>提醒：优先检测全量版本号。</p>
</blockquote>
<h3 id="9-1-1-版本配置"><a href="#9-1-1-版本配置" class="headerlink" title="9.1.1 版本配置"></a>9.1.1 版本配置</h3><p><br />在version.json中我们可以配置版本信息。<br /><br><br />配置项介绍如下：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>frameVersion</td>
<td>String</td>
<td>全量包版本号</td>
</tr>
<tr>
<td>appVersion</td>
<td>String</td>
<td>增量包版本号</td>
</tr>
</tbody></table>
<h3 id="9-1-2-开启自动更新检测"><a href="#9-1-2-开启自动更新检测" class="headerlink" title="9.1.2 开启自动更新检测"></a>9.1.2 开启自动更新检测</h3><p><br />通过在<code>init.json</code>中配置_<strong>checkUpdateUrl</strong>_来开启自动更新检测：<br /></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"checkUpdateUrl": "http://127.0.0.1/update.json"</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注：更新服务可以指向一个可访问的json请求地址，也可以是一个.action请求接口。</p>
</blockquote>
<h3 id="9-1-3-建议文件结构"><a href="#9-1-3-建议文件结构" class="headerlink" title="9.1.3 建议文件结构"></a>9.1.3 建议文件结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version                   &#x2F;&#x2F; 自动更新文件夹</span><br><span class="line">			- appVersion            &#x2F;&#x2F;用来存放增量包的文件夹</span><br><span class="line">								- ResourceSetup.exe &#x2F;&#x2F;增量包exe文件</span><br><span class="line">			- frameVersion          	 &#x2F;&#x2F;用来存放全量包的文件夹</span><br><span class="line">								- Setup.exe      &#x2F;&#x2F;全量包exe文件</span><br><span class="line">changelog.txt         &#x2F;&#x2F;自动更新日志</span><br><span class="line">update.json           &#x2F;&#x2F;自动更新配置文件</span><br></pre></td></tr></table></figure>

<h3 id="9-1-4-自动更新服务报文内容"><a href="#9-1-4-自动更新服务报文内容" class="headerlink" title="9.1.4 自动更新服务报文内容"></a>9.1.4 自动更新服务报文内容</h3><p><br />update.json内容如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"windows"</span>: &#123;</span><br><span class="line">      <span class="attr">"appVersion"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">      <span class="attr">"frameVersion"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">      <span class="attr">"appUpdateUrl"</span>: <span class="string">"http://****/**/ResourceSetup.exe"</span>,</span><br><span class="line">      <span class="attr">"frameUpdateUrl"</span>: <span class="string">"http://****/**/Setup.exe"</span>,</span><br><span class="line">      <span class="attr">"appSign"</span>:<span class="string">"e3681da227e879fecc3e0b071a8787b0"</span>,</span><br><span class="line">      <span class="attr">"frameSign"</span>:<span class="string">"8c89e13fd3bbfed0c485c429d9a617d1"</span>,</span><br><span class="line">      <span class="attr">"forceUpdate"</span>:<span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"more"</span>:&#123;</span><br><span class="line">        <span class="attr">"updateTime"</span>:<span class="string">"2018-2-6"</span>,</span><br><span class="line">        <span class="attr">"changelog"</span>:<span class="string">"http://****/**/changelog.txt"</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><br />配置项说明：</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>参数类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>appVersion</td>
<td>String</td>
<td>增量包所对应的版本号，需要与项目中version.json中的增量版本号对应</td>
</tr>
<tr>
<td>frameVersion</td>
<td>String</td>
<td>全量包所对应的版本号，需要与项目中version.json中的全量版本号对应</td>
</tr>
<tr>
<td>appUpdateUrl</td>
<td>String</td>
<td>增量包下载地址</td>
</tr>
<tr>
<td>frameUpdateUrl</td>
<td>String</td>
<td>全量包下载地址</td>
</tr>
<tr>
<td>appSign</td>
<td>String</td>
<td>增量包文件MD5加密码 由MOCK工具生成</td>
</tr>
<tr>
<td>frameSign</td>
<td>String</td>
<td>全量包文件MD5加密码 由MOCK工具生成</td>
</tr>
<tr>
<td>forceUpdate</td>
<td>Boolean</td>
<td>是否强制更新</td>
</tr>
<tr>
<td>more</td>
<td>Object</td>
<td>自动更新的提示内容；包含<code>updateTime</code>(更新时间)和<code>changelog</code>(更新提示的内容)属性</td>
</tr>
</tbody></table>
<h2 id="9-2-开启完整性检测"><a href="#9-2-开启完整性检测" class="headerlink" title="9.2 开启完整性检测"></a>9.2 开启完整性检测</h2><p><br />为了保障客户端运行环境的安全，对关键electron文件(.dll等)及项目资源包(.asar)做md5校验，保障运行环境中客户端是完整未被篡改的。<br />为了方便不同使用人员快速对客户端文件生成加密串，提供了包括：命令式 和 工具exe。<br /></p>
<h3 id="9-2-1-客户端集成方法"><a href="#9-2-1-客户端集成方法" class="headerlink" title="9.2.1 客户端集成方法"></a>9.2.1 客户端集成方法</h3><p><br />可根据服务端支持情况，通过配置开启防篡改功能，可在init.json配置中增加:<br /></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;enableTamperValidate&quot;: true</span><br></pre></td></tr></table></figure>

<p><br />相关配置说明：<br /></p>
<ul>
<li>tamperResistantUrl: 默认接口地址’tamperProofing.action’</li>
<li>enableTamperValidate: 是否启用防篡改验证功能，默认false</li>
</ul>
<p><br />检测过程：</p>
<ol>
<li>请求接口</li>
<li>解密报文</li>
<li>判断istamper是否为”1”</li>
<li>通过filelist生成sign值与接口数据sign是否一致，如果false，立即退出，返回检测结果”不通过”</li>
</ol>
<blockquote>
<p>备注：当检测不通过时，过8秒自动关闭客户端。</p>
</blockquote>
<h3 id="9-2-2-前提"><a href="#9-2-2-前提" class="headerlink" title="9.2.2 前提"></a>9.2.2 前提</h3><p><br />服务端支持防篡权请求接口<code>tamperProofing.action</code>通过init.json中<code>tamperResistantUrl</code>来修改请求服务地址。<br /></p>
<ol>
<li><em><strong>请求接口参数格式：</strong></em></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let  requestJson &#x3D; &#123;</span><br><span class="line">      platform: &quot;4&quot;,</span><br><span class="line">      versions: [</span><br><span class="line">          &#123; version:”0.1.0”,type: “1”&#125;,</span><br><span class="line">          &#123; version:”0.1.0”,type: “2”&#125;</span><br><span class="line">      ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注：请求参数使用RSA加密(与握手秘钥相同)。</p>
</blockquote>
<p><br />参数描述：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>platform</td>
<td>平台类型，1:’IOS’,2:’Android’,3:’PC’,4:’electron’</td>
<td>String</td>
</tr>
<tr>
<td>type</td>
<td>资源类型， 1: 框架资源(根目录下dll,exe等，排除resources,locales之外), 2: resources 资源</td>
<td>String</td>
</tr>
<tr>
<td>version</td>
<td>版本号，对应version.json中appVersion(对应type值为”2”),frameVersion(对应type值为”1”)</td>
<td>Array</td>
</tr>
</tbody></table>
<ol start="2">
<li><em><strong>返回数据格式：</strong></em><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;data&quot;:&#123;</span><br><span class="line">        &quot;result&quot;: &#123;</span><br><span class="line">            &quot;istamper&quot;: &quot;1&quot;,</span><br><span class="line">            &quot;resData&quot;: [</span><br><span class="line">                &#123;&quot;sign&quot;:&quot;&quot;,&quot;filelist&quot;:&quot;&quot;,&quot;type&quot;:&quot;1&quot;&#125;,</span><br><span class="line">                &#123;&quot;sign&quot;:&quot;&quot;,&quot;filelist&quot;:&quot;&quot;,&quot;type&quot;:&quot;2&quot;&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;success&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<p>备注：返回报文是使用RSA加密，客户端做解密，istamper字段标识是否客户端需要做防篡改校验。</p>
</blockquote>
<p><br />字段说明：</p>
<ul>
<li>sign: 生成的hash加密串</li>
<li>filelist: 加密文件列表，以”,”分割</li>
</ul>
<h3 id="9-2-3-基于命令生成加密hash"><a href="#9-2-3-基于命令生成加密hash" class="headerlink" title="9.2.3 基于命令生成加密hash"></a>9.2.3 基于命令生成加密hash</h3><p><br />前提电脑已经安装<a href="http://nodejs.cn/download/" target="_blank" rel="noopener">node.js</a>并指定公司npm源。<br /><br><br />指定引用公司源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry http:&#x2F;&#x2F;192.168.10.152:7001</span><br></pre></td></tr></table></figure>

<p><br />全局安装包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @erayt&#x2F;hfile -g</span><br></pre></td></tr></table></figure>

<p><br />用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ hfile --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">  Usage: hfile [options] [<span class="built_in">command</span>]</span><br><span class="line"></span><br><span class="line">  Manipulate hfile archive files</span><br><span class="line"></span><br><span class="line">  Options:</span><br><span class="line">    -V, --version                    output the version number</span><br><span class="line">    -h, --<span class="built_in">help</span>                       output usage information</span><br><span class="line"></span><br><span class="line">  Commands:</span><br><span class="line">    <span class="built_in">hash</span>|h [options] &lt;dir&gt; &lt;output&gt;  create hfile archive</span><br></pre></td></tr></table></figure>

<p><br />排除多个文件:<br /><br><br />Given:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    app</span><br><span class="line">(a) ├── x1</span><br><span class="line">(b) ├── x2</span><br><span class="line">(c) ├── y3</span><br><span class="line">(d) │   ├── x1</span><br><span class="line">(e) │   └── z1</span><br><span class="line">(f) │       └── x2</span><br><span class="line">(g) └── z4</span><br><span class="line">(h)     └── w1</span><br></pre></td></tr></table></figure>

<p><br />Exclude: a, b</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hfile h app sign.txt --unpack-dir <span class="string">"&#123;x1,x2&#125;"</span></span><br></pre></td></tr></table></figure>

<p><br />Exclude: a, b, d, f</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hfile h app sign.txt --unpack-dir <span class="string">"**/&#123;x1,x2&#125;"</span></span><br></pre></td></tr></table></figure>

<p><br />Exclude: a, b, d, f, h</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hfile h app sign.txt --unpack-dir <span class="string">"&#123;**/x1,**/x2,z4/w1&#125;"</span></span><br></pre></td></tr></table></figure>

<p><br />对客户端资源文件生成hash:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> root</span><br><span class="line">hfile h ./resources ../resources.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注：root为客户端根目录。</p>
</blockquote>
<p><br />对electron底层相关dll等生成hash，忽略resources,locales目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hfile h . ../frame.txt --unpack-dir=<span class="string">"&#123;resources,locales&#125;"</span> --unpack=unins000.*</span><br></pre></td></tr></table></figure>

<blockquote>
<p>备注：unins000.dat,unins000.exe 为安装程序时生成，属于动态文件所以要忽略。</p>
</blockquote>
<h3 id="9-2-4-基于加密工具客户端生成"><a href="#9-2-4-基于加密工具客户端生成" class="headerlink" title="9.2.4 基于加密工具客户端生成"></a>9.2.4 基于加密工具客户端生成</h3><p><br />为了不同人员需求，提供客户端版本供使用，操作界面如下：<br /><img src="/images/zebra/6/02.png" alt="tool.png"></p>
<blockquote>
<p>备注：可点击”copy”将值复制到剪贴板。</p>
</blockquote>
<h1 id="十、异常信息收集"><a href="#十、异常信息收集" class="headerlink" title="十、异常信息收集"></a>十、异常信息收集</h1><p><br />投产的项目从表面现象根据客户描述我们很难定位排查到具体问题。所以异常信息的收集并记录显得尤为重要。虽然我们的项目非自运营产品，没有配套的日志监控系统等基础建设来支撑，但是我们可以对_<strong>window.onerror</strong>_做统一监听，并把日志记录到日志文件。<br /><br><br />系统主进程相关过程默认会有相关启动日志，根据情况合理设置日志级别：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"logLevel": "warn"</span><br></pre></td></tr></table></figure>

<p><em><strong>Q：如何开启error日志监听？</strong></em><br />A：可init.json中配置<code>&quot;reportJsError&quot;: true</code>来开启全局监听，系统右下角提示，并记录日志文件(方便问题排查定位)。<br /><br><br /><strong>看完如果有启发，给辛勤的开源者送颗稻草吧</strong><br />👇</p>

    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Zebra</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2020/04/25/ajax/" class="pre-post btn btn-default" title='第七期 - 「AJAX通讯组件封装及使用」- (2020.4.25)'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            第七期 - 「AJAX通讯组件封装及使用」- (2020.4.25)</span>
    </a>
    
    
    <a href="/2020/04/11/micro-frontend/" class="next-post btn btn-default" title='第五期 - 「面向大型中后台应用微前端解决方案」 - (2020.4.11)'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            第五期 - 「面向大型中后台应用微前端解决方案」 - (2020.4.11)</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>

<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: '0q0vid2kizGymmd0dNKs3lOY-gzGzoHsz',
    appKey: 'wNj5sJAu5hReOirB3QbKqNiA',
    placeholder: '说点什么吧',
    notify: false,
    verify: true,
    avatar: 'mm',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: 'zh-CN'.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、前言"><span class="toc-text">一、前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、介绍"><span class="toc-text">二、介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-我是谁？"><span class="toc-text">2.1. 我是谁？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-我们的团队"><span class="toc-text">2.2. 我们的团队</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-怎么联系我？"><span class="toc-text">2.3. 怎么联系我？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、主题背景"><span class="toc-text">三、主题背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、初始化工程"><span class="toc-text">四、初始化工程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-什么是Yeoman"><span class="toc-text">4.1 什么是Yeoman?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-安装yo以及脚手架"><span class="toc-text">4.2 安装yo以及脚手架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-创建工程"><span class="toc-text">4.3 创建工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-创建业务模块"><span class="toc-text">4.4 创建业务模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-创建多应用"><span class="toc-text">4.5 创建多应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五、工程规范"><span class="toc-text">五、工程规范</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-标准工程目录及配置"><span class="toc-text">5.1 标准工程目录及配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-主要目录介绍"><span class="toc-text">5.1.1 主要目录介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-webpack-config-js"><span class="toc-text">5.1.2 webpack.config.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-titanOne"><span class="toc-text">5.1.3 .titanOne</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-4-config-json"><span class="toc-text">5.1.4 config.json</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-项目规范"><span class="toc-text">5.2 项目规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-工程目录结构"><span class="toc-text">5.2.1 工程目录结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-模块目录结构"><span class="toc-text">5.2.2 模块目录结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-关键文件规范"><span class="toc-text">5.2.3 关键文件规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-4-自定义样式存放目录"><span class="toc-text">5.2.4 自定义样式存放目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-配置文件"><span class="toc-text">5.3 配置文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#六、主应用启动过程"><span class="toc-text">六、主应用启动过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#七、开发阶段"><span class="toc-text">七、开发阶段</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#八、入库发布版本"><span class="toc-text">八、入库发布版本</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-维护配置"><span class="toc-text">8.1 维护配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-1-子应用mapping-json配置"><span class="toc-text">8.1.1 子应用mapping.json配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-2-子应用setting-json配置"><span class="toc-text">8.1.2 子应用setting.json配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-3-主应用version-json配置"><span class="toc-text">8.1.3 主应用version.json配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-4-主应用init-json配置"><span class="toc-text">8.1.4 主应用init.json配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-5-FAQ"><span class="toc-text">8.1.5 FAQ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-版本入库"><span class="toc-text">8.2 版本入库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-Node-js打包"><span class="toc-text">8.2.1 Node.js打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-Setup"><span class="toc-text">8.2.2 Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-3-Node-js"><span class="toc-text">8.2.3 Node.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-4-FAQ"><span class="toc-text">8.2.4 FAQ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#九、预投产演练阶段"><span class="toc-text">九、预投产演练阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-自动更新"><span class="toc-text">9.1 自动更新</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-1-版本配置"><span class="toc-text">9.1.1 版本配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-2-开启自动更新检测"><span class="toc-text">9.1.2 开启自动更新检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-3-建议文件结构"><span class="toc-text">9.1.3 建议文件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-4-自动更新服务报文内容"><span class="toc-text">9.1.4 自动更新服务报文内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-开启完整性检测"><span class="toc-text">9.2 开启完整性检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-1-客户端集成方法"><span class="toc-text">9.2.1 客户端集成方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-2-前提"><span class="toc-text">9.2.2 前提</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-3-基于命令生成加密hash"><span class="toc-text">9.2.3 基于命令生成加密hash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-4-基于加密工具客户端生成"><span class="toc-text">9.2.4 基于加密工具客户端生成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#十、异常信息收集"><span class="toc-text">十、异常信息收集</span></a></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2020
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/assets/tagcanvas.min.js?rev=2.9.js"></script>

<script>
var tagOption = {
    textColour: '#444', // 字体颜色
    outlineMethod: 'block', // 选中模式
    outlineColour: '#FFDAB9', // 选中模式的颜色
    interval: 30 || 30, // 动画帧之间的时间间隔，值越大，转动幅度越大
    textHeight: 13,
    outlineRadius: 3,
    freezeActive: true || '', // 选中的标签是否继续滚动
    frontSelect: true || '', // 不选标签云后部的标签
    initial: [0.1, -0.1],
    depth: 0.5,
    decel: 0.95,
    maxSpeed: 0.03,
    reverse: true || '', // 是否反向触发
    fadeIn: 500, // 进入动画时间
    wheelZoom: false || '' // 是否启用鼠标滚轮
}
TagCanvas.Start('tag-cloud-3d', '', tagOption);
</script>



<script src="/js/app.js?rev=@@hash.js"></script>

</body>
</html>